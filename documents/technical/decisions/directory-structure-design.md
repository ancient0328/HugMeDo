# ディレクトリ構造設計の決定記録

**文書番号**: DEC-001  
**作成日**: 2025-03-21  
**最終更新日**: 2025-03-22  
**バージョン**: 1.0.0  
**ステータス**: 確定  
**関連文書**: 
- ARCH-001 (アーキテクチャ概要)
- ARCH-002 (コンテナ化モジュラーモノリス)
- GUIDE-002 (開発環境セットアップ)

## 決定事項

以下のディレクトリ構造を採用します：

```
HugMeDo/
├── apps/              # アプリケーション
│   ├── web/           # Webアプリケーション（SvelteKit）
│   └── mobile/        # モバイルアプリケーション（SvelteKit + Capacitor）
│
├── modules/           # 機能モジュール
│   ├── api-gateway/   # APIゲートウェイ（認証実装を含む）
│   ├── ohr/           # ビデオ通話モジュール
│   ├── chat/          # チャットモジュール
│   └── halca/         # メンタルヘルスチェックモジュール
│
└── packages/          # 共有パッケージ
    ├── core/          # コアライブラリ
    │   ├── auth/      # 認証関連のインターフェースと型定義
    │   ├── api/       # API関連のユーティリティ
    │   └── types/     # 型定義
    ├── ui/            # UIコンポーネント
    └── utils/         # ユーティリティ関数
```

## 設計思想

### 1. 関心の分離と明確な責任分担

各ディレクトリは特定の関心事に焦点を当て、明確な責任を持ちます：

- **apps/**: エンドユーザー向けアプリケーションを含み、UIとユーザー体験に集中
- **modules/**: 特定のビジネスドメイン機能を実装する独立したモジュール
- **packages/**: 複数のアプリケーションやモジュールで共有される再利用可能なコード

この分離により、コードの理解、テスト、保守が容易になります。

### 2. 共有カーネルとしてのpackages/core

`packages/core`は共有カーネルとして機能し、以下の利点があります：

- **型の一貫性**: 共通の型定義を提供することで、モジュール間のデータ交換の安全性を確保
- **インターフェースの標準化**: 認証やAPI通信などの共通インターフェースを定義
- **重複の排除**: 複数のモジュールで必要となる基本的な機能を一箇所に集約

この設計により、各モジュールは独自のドメインロジックに集中しながら、共通の基盤を活用できます。

### 3. モジュール間の明確な境界

各機能モジュールは独立したディレクトリに配置され、明確なAPIを通じて通信します：

- **api-gateway**: 外部からのリクエストを適切なモジュールにルーティング
- **ohr**: ビデオ通話機能に特化したモジュール
- **chat**: リアルタイムチャット機能を担当するモジュール
- **halca**: メンタルヘルスチェック機能を提供するモジュール

この境界の明確化により、モジュール間の依存関係が制御され、並行開発が容易になります。

### 4. 段階的な進化を考慮した設計

この構造は、将来的な拡張や変更に対応できるように設計されています：

- **新しいモジュールの追加**: 既存のパターンに従って新しいモジュールを追加可能
- **マイクロサービスへの移行**: 必要に応じて特定のモジュールをマイクロサービスとして分離可能
- **技術スタックの更新**: 特定のモジュールの技術スタックを他に影響を与えずに更新可能

### 5. pnpmワークスペースとの統合

この構造はpnpmワークスペースと自然に統合され、以下の利点があります：

- **依存関係の局所化**: 各モジュールは独自の依存関係を管理
- **ワークスペース間の参照**: ローカル参照を通じてワークスペース間の依存関係を簡単に管理
- **並行開発**: 複数の開発者が異なるモジュールを同時に開発可能


## まとめ

採用したディレクトリ構造は、コンテナ化モジュラーモノリスアーキテクチャの原則に沿っており、関心の分離、明確な責任分担、段階的な進化を促進します。この構造により、開発チームは効率的に協力し、高品質なソフトウェアを提供することができます。

## 影響

- **開発プロセス**: 各モジュールは独立して開発・テスト可能
- **CI/CD**: モジュールごとに独立したビルド・デプロイパイプラインの構築が可能
- **チーム編成**: モジュールごとに専門チームを編成可能
- **ドキュメント**: 各モジュールは独自のドキュメントを持ち、全体のアーキテクチャドキュメントと連携

## 関連ドキュメント

- [アーキテクチャ概要](/documents/architecture/architecture-overview.md)
- [コンテナ化モジュラーモノリス](/documents/architecture/containerized-modular-monolith.md)
- [開発環境セットアップガイド](/documents/guides/development-environment-setup.md)

# プロジェクト記録 02: Svelte 5コンプライアンス対応

## 概要

**文書番号**: RECORD-02
**日付**: 2025年3月21日
**担当者**: 古川和博
**ステータス**: 完了

## 目的

HugMeDoプロジェクトにおいて、Svelte 5の新しいイベント構文に準拠するための対応を行い、コード品質と一貫性を確保する。

## 実施内容

### 1. ガイドラインの作成

Svelte 5の新しいイベント構文に関するガイドラインを作成し、開発者が参照できるようにした。

- **ファイル**: `.hugmedo/svelte5-guidelines.md`
- **内容**:
  - イベントハンドラの構文変更（`on:event` → `onevent`）の説明
  - 具体的な変換例（`on:submit` → `onsubmit`など）
  - 注意点とベストプラクティス

### 2. コーディングチェックリストの作成

プロジェクト全体のコーディング規約を遵守するためのチェックリストを作成した。

- **ファイル**: `.hugmedo/coding-checklist.md`
- **内容**:
  - 基本的なコーディング規約
  - Svelte 5固有の規則
  - ファイル命名規則
  - コード品質基準

### 3. 編集テンプレートの作成

Svelteコンポーネントを編集する際に使用するテンプレートを作成し、構文変換の一貫性を確保した。

- **ファイル**: `.hugmedo/svelte-edit-template.md`
- **内容**:
  - 修正前チェックリスト
  - 構文変換計画テンプレート
  - 修正後確認事項

### 4. 自動チェックツールの開発

プロジェクト内のSvelteファイルをスキャンし、古いイベント構文を検出するスクリプトを開発した。

- **ファイル**: `.hugmedo/check-svelte-syntax.js`
- **機能**:
  - 古い構文（`on:event`）の検出
  - 修正が必要な箇所のリスト表示
  - 一括置換コマンドの提案

### 5. HARCA連携設定の実装

HARCAとWindsurf Cascadeを連携させ、Svelte 5のイベント構文を確実に正しく変換するための設定を実装した。

- **ファイル**:
  - `.hugmedo/harca-config.json`: HARCAの動作設定
  - `.hugmedo/harca-activation.js`: 設定の有効化スクリプト
  - `.hugmedo/harca-hooks.js`: 編集前後のフック処理
  - `.hugmedo/windsurf-cascade-config.json`: Cascadeの動作設定

- **機能**:
  - イベント構文の変換方向の検証（`on:event` → `onevent`）
  - 逆方向の変換（`onevent` → `on:event`）のブロック
  - 編集前後の自動チェック
  - 優先度の高いプロジェクトルールの適用

### 6. 使用方法ガイドの作成

開発者向けに、各ツールの使用方法と注意事項をまとめたREADMEを作成した。

- **ファイル**: `.hugmedo/README.md`
- **内容**:
  - 各ツールの概要と使用方法
  - 自動チェックの実行方法
  - 一括置換の手順と注意点

## 技術的詳細

### イベント構文の変更

Svelte 5では、イベントハンドラの構文が以下のように変更された：

- **古い構文**: `on:event={handler}`
- **新しい構文**: `onevent={handler}`

例：
- `on:submit={handleSubmit}` → `onsubmit={handleSubmit}`
- `on:click={handleClick}` → `onclick={handleClick}`
- `on:input={handleInput}` → `oninput={handleInput}`

### 自動チェックの仕組み

`check-svelte-syntax.js`スクリプトは、以下のディレクトリ内のSvelteファイルをスキャンする：

- `apps/mobile/src`
- `apps/web/src`
- `packages/ui/src`

正規表現を使用して古い構文（`on:event`）を検出し、修正が必要な箇所をリストアップする。

### HARCA連携の仕組み

HARCAとWindsurf Cascadeの連携により、以下の機能が実現された：

1. **構文変換の強制**:
   - イベント構文の変換方向を検証
   - 逆方向の変換をブロック

2. **自動チェック機構**:
   - 編集前に構文パターンを分析
   - 編集後に変換方向を検証

3. **優先度設定**:
   - Svelte 5イベント構文ルールを最優先に設定
   - メモリの自動参照を強制

## 今後の課題

1. **既存コードの一括変換**:
   - プロジェクト全体の既存コードを新しい構文に一括変換する
   - 変換後の動作確認を徹底する

2. **CI/CDパイプラインへの組み込み**:
   - 構文チェックをCI/CDパイプラインに組み込み、自動検証する
   - プルリクエスト時に自動チェックを実行する

3. **開発者トレーニング**:
   - 新しい構文と変換ツールの使用方法について開発者にトレーニングを実施する
   - ドキュメントを充実させ、参照しやすくする

## 結論

Svelte 5の新しいイベント構文に準拠するための対応を行い、コード品質と一貫性を確保するための仕組みを整備した。これにより、開発者は一貫した方法でコードを記述でき、プロジェクト全体の品質向上につながる。

また、HARCAとWindsurf Cascadeの連携により、構文変換の自動チェックと強制が可能になり、誤った変換を防止できるようになった。今後は、既存コードの一括変換とCI/CDパイプラインへの組み込みを進め、プロジェクト全体の品質をさらに向上させる。
